#!/icg/bin/perl
use strict;
use warnings;
use DNS::Oterica::Hub;
use File::Find::Rule;
use YAML ();

my $hub = DNS::Oterica::Hub->new;

my @files = File::Find::Rule->file->in('etc');

for my $file (@files) {
  my ($data) = YAML::LoadFile($file);

  my $node = $hub->node(
    $data->{domain},
    $data->{hostname},
    { ip => $data->{ip}{world} },
  );

  for my $name (@{ $data->{roles} }) {
    my $role = $hub->node_role($name);

    $node->add_to_role($role);
  }
}

print $_->as_data_lines, "\n" for $hub->nodes;
print $_->as_data_lines, "\n" for $hub->node_roles;
